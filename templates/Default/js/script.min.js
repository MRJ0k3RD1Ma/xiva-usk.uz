/* eslint-disable */ 
function Widget(src, opaId, isFz59) {
  let fz59 = isFz59 ? 'true' : 'false';
  src += '?opaId=' + opaId + '&fz59=' + fz59;

  let div = document.createElement('div');
  let header = document.createElement('header');
  let overlay = document.createElement('div');
  let body = document.getElementsByTagName('body')[0];

  //  css
  div.style.background = 'white';
  div.style.position = 'fixed';
  div.style.maxWidth = '620px';
  div.style.maxHeight = '768px';
  div.style.margin = 'auto';
  div.style.top = '0';
  div.style.bottom = '0';
  div.style.left = '0';
  div.style.right = '0';
  div.style.zIndex = '999999999';

  overlay.style.position = 'fixed';
  overlay.style.zIndex = '999999998';
  overlay.style.width = '100%';
  overlay.style.height = '100%';
  overlay.style.top = '0';
  overlay.style.left = '0';
  overlay.style.backgroundColor = 'rgba(0,0,0,.3)';

  // attr
  div.setAttribute('id', 'js-iframe-wrapper');
  overlay.setAttribute('id', 'js-iframe-overlay');
  let iframe = document.createElement('iframe');

  iframe.style.width = '100%';
  iframe.style.height = '100%';
  iframe.style.border = '0';

  iframe.setAttribute('src', src);
  iframe.setAttribute('id', 'js-iframe-widget');
  iframe.referrerPolicy = 'unsafe-url';

  div.appendChild(iframe);
  header.innerHTML = 'Новое обращение';

  function destroy() {
    let body = document.getElementsByTagName('body')[0];
    let wOverlay = document.getElementById('js-iframe-overlay');
    let wWrapper = document.getElementById('js-iframe-wrapper');
    body.removeChild(wWrapper);
    body.removeChild(wOverlay);
  }

  function create() {
    body.appendChild(div);
    body.appendChild(overlay);
  }

  function closeWidget(){
    destroy()
  }

  function showWidget(){
    create()
  }

  const openWidgetBtn = document.getElementById('js-show-iframe-wrapper');

  const openWidgetListener = function (e) {
    e.preventDefault();
    showWidget()
  };

  openWidgetBtn.addEventListener('click', openWidgetListener);

  openWidgetBtn.addEventListener('touchstart', function (e) {
    e.preventDefault();
    showWidget();
  });

  window.addEventListener('message', function(event) {
    if(event.data.close) {
      closeWidget();
    }
  }, false);

}
